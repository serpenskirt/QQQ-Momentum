name: QQQ Momentum Strategy

on:
  schedule:
    # Runs every 5 minutes from hour 13 through 21 UTC (Approx 8am-5pm EST)
    # Mon-Fri (1-5)
    - cron: '*/5 13-21 * * 1-5'
  workflow_dispatch: # Allows manual trigger for testing

jobs:
  run-strategy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install requests pandas pytz

      # ---------------------------------------------------------
      # STEP 1: SELL CHECK (PRIORITY - RUNS EVERY 5 MINS)
      # ---------------------------------------------------------
      - name: Run SELL Strategy
        env:
          TRADIER_TOKEN: ${{ secrets.TRADIER_TOKEN }}
          OA_WEBHOOK_SELL: ${{ secrets.OA_WEBHOOK_SELL }}
          OA_WEBHOOK_BUY: ${{ secrets.OA_WEBHOOK_BUY }}
        run: python main.py --mode sell

# ---------------------------------------------------------
      # STEP 2: BUY CHECK (Run every time)
      # ---------------------------------------------------------
      - name: Run BUY Strategy
        env:
          TRADIER_TOKEN: ${{ secrets.TRADIER_TOKEN }}
          OA_WEBHOOK_BUY: ${{ secrets.OA_WEBHOOK_BUY }}
          OA_WEBHOOK_SELL: ${{ secrets.OA_WEBHOOK_SELL }}
        run: python main.py --mode buy